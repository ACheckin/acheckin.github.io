(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1515:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return n}));a(63);var i=a(20);function s(e,t,a){return s=>r(s(i.login(e,t,a)))}function n(e,t,a){return s=>r(s(i.loginById(e,t,a)))}async function r(e){let t=await e;return t.error&&"api.context.mfa_required.app_error"===t.error.server_error_id&&(t={data:!0}),t}},2093:function(e,t,a){e.exports=a.p+"files/a9513776bab8fe4b66ff654634be41b6.png"},2261:function(e,t,a){"use strict";a.r(t);var i=a(323),s=a(8),n=a(16),r=a(17),o=a(11),l=a(12),c=a(1336),d=a(1515),p=(a(63),a(147),a(64),a(178),a(75),a(35),a(711),a(34)),m=a.n(p),g=a(7),h=a.n(g),u=a(1231),E=a(328),f=a(1229),b=a(19),S=a(1245),N=a(126),w=a(122),I=a(0),v=a(1450),_=a(1244),U=a(41),x=a(15),L=a(21),P=a(1489),y=a.n(P),R=a(2093),C=a.n(R);let M=!1;var O=a(28),T=a(1256),W=a(1239),q=a(1246),A=a(1304),D=a(1381),k=a(1307),j=a(1253);function G(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class B extends h.a.Component{constructor(e){super(e),G(this,"configureTitle",()=>{this.state.sessionExpired?document.title=this.props.intl.formatMessage({id:"login.session_expired.title",defaultMessage:"* {siteName} - Session Expired"},{siteName:this.props.siteName}):document.title=this.props.siteName}),G(this,"showSessionExpiredNotificationIfNeeded",()=>{this.state.sessionExpired&&!this.closeSessionExpiredNotification?async function({title:e,body:t,requireInteraction:a,silent:i,onClick:s}={title:"",body:"",requireInteraction:!1,silent:!1}){let n=y.a;if(L.e()&&(n=C.a),!("Notification"in window))throw new Error("Notification not supported");if("function"!=typeof Notification.requestPermission)throw new Error("Notification.requestPermission not supported");if("granted"!==Notification.permission&&M)throw new Error("Notifications already requested but not granted");M=!0;let r=await Notification.requestPermission();if(void 0===r&&(r=await new Promise(e=>{Notification.requestPermission(e)})),"granted"!==r)throw new Error("Notifications not granted");const o=new Notification(e,{body:t,tag:t,icon:n,requireInteraction:a,silent:i});return s&&(o.onclick=s),o.onerror=()=>{throw new Error("Notification failed to show.")},a||L.m()||setTimeout(()=>{o.close()},I.P.DEFAULT_NOTIFICATION_DURATION),()=>{o.close()}}({title:this.props.siteName,body:x.fb("login.session_expired.notification","Session Expired: Please sign in to continue receiving notifications."),requireInteraction:!0,silent:!1,onClick:()=>{window.focus(),this.closeSessionExpiredNotification()&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}}).then(e=>{this.closeSessionExpiredNotification=e}).catch(()=>{}):!this.state.sessionExpired&&this.closeSessionExpiredNotification&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}),G(this,"preSubmit",e=>{e.preventDefault(),this.onDismissSessionExpired();const{location:t}=this.props,a=t.search.replace(/(extra=password_change)&?/i,"");a!==t.search&&w.a.replace("".concat(t.pathname).concat(a).concat(t.hash));let i=this.state.loginId;this.loginIdInput.current&&(i=this.loginIdInput.current.value,i!==this.state.loginId&&this.setState({loginId:i}));let s=this.state.password;if(this.passwordInput.current&&(s=this.passwordInput.current.value,s!==this.state.password&&this.setState({password:s})),i=i.trim().toLowerCase(),!i){Object(O.b)("login.noEmail"),Object(O.b)("login.noEmailLdapUsername"),Object(O.b)("login.noEmailUsername"),Object(O.b)("login.noEmailUsernameLdapUsername"),Object(O.b)("login.noLdapUsername"),Object(O.b)("login.noUsername"),Object(O.b)("login.noUsernameLdapUsername");let e="login.no";return this.state.emailSigninEnabled&&(e+="Email"),this.state.usernameSigninEnabled&&(e+="Username"),this.state.ldapEnabled&&(e+="LdapUsername"),void this.setState({serverError:h.a.createElement(u.a,{id:e,values:{ldapUsername:this.props.ldapLoginFieldName||x.fb("login.ldapUsernameLower","AD/LDAP username")}})})}s?this.submit(i,s,""):this.setState({serverError:h.a.createElement(u.a,{id:"login.noPassword",defaultMessage:"Please enter your password"})})}),G(this,"submit",(e,t,a)=>{this.setState({serverError:null,loading:!0}),this.props.actions.login(e,t,a).then(async({error:t})=>{if(t)return void("api.user.login.not_verified.app_error"===t.server_error_id?w.a.push("/should_verify_email?&email="+encodeURIComponent(e)):"store.sql_user.get_for_login.app_error"===t.server_error_id||"ent.ldap.do_login.user_not_registered.app_error"===t.server_error_id?this.setState({showMfa:!1,loading:!1,serverError:h.a.createElement(u.a,{id:"login.userNotFound",defaultMessage:"We couldn't find an account matching your login credentials."})}):"api.user.check_user_password.invalid.app_error"===t.server_error_id||"ent.ldap.do_login.invalid_password.app_error"===t.server_error_id?this.setState({showMfa:!1,loading:!1,serverError:h.a.createElement(u.a,{id:"login.invalidPassword",defaultMessage:"Your password is incorrect."})}):this.state.showMfa||"mfa.validate_token.authenticate.app_error"!==t.server_error_id?this.setState({showMfa:!1,serverError:t.message,loading:!1}):this.setState({showMfa:!0}));const a=new URLSearchParams(this.props.location.search),i=a.get("t")||"",s=a.get("id")||"";if(s||i){const{data:e}=await this.props.actions.addUserToTeamFromInvite(i,s);e?this.finishSignin(e):this.finishSignin()}else this.finishSignin()})}),G(this,"finishSignin",e=>{const t=this.props.experimentalPrimaryTeam,a=new URLSearchParams(this.props.location.search).get("redirect_to");x.mb(),N.a.setWasLoggedIn(!0),a&&a.match(/^\/([^/]|$)/)?w.a.push(a):e?w.a.push("/".concat(e.name)):t?w.a.push("/".concat(t)):S.f()}),G(this,"handleLoginIdChange",e=>{this.setState({loginId:e.target.value})}),G(this,"handlePasswordChange",e=>{this.setState({password:e.target.value})}),G(this,"handleBrandImageError",()=>{this.setState({brandImageError:!0})}),G(this,"createCustomLogin",()=>{if(this.props.enableCustomBrand){const e=this.props.customBrandText||"",t=U.e(e),a=b.Client4.getBrandImageUrl(0),i=this.state.brandImageError?{display:"none"}:{};return h.a.createElement("div",null,h.a.createElement("img",{alt:"brand image",src:a,onError:this.handleBrandImageError,style:i}),h.a.createElement("div",null,Object(v.a)(t,!1,{mentions:!1,imagesMetadata:null})))}return null}),G(this,"createLoginPlaceholder",()=>{const e=this.state.ldapEnabled,t=this.state.usernameSigninEnabled,a=[];return this.state.emailSigninEnabled&&a.push(x.fb("login.email","Email")),t&&a.push(x.fb("login.username","Username")),e&&(this.props.ldapLoginFieldName?a.push(this.props.ldapLoginFieldName):a.push(x.fb("login.ldapUsername","AD/LDAP Username"))),a.length>=2?a.slice(0,a.length-1).join(", ")+x.fb("login.placeholderOr"," or ")+a[a.length-1]:1===a.length?a[0]:""}),G(this,"checkSignUpEnabled",()=>this.props.enableSignUpWithEmail||this.props.enableSignUpWithGitLab||this.props.enableSignUpWithOffice365||this.props.enableSignUpWithGoogle||this.props.enableLdap||this.props.enableSaml),G(this,"onDismissSessionExpired",()=>{N.a.setWasLoggedIn(!1),this.setState({sessionExpired:!1})}),G(this,"createExtraText",()=>{const e=new URLSearchParams(this.props.location.search).get("extra");return this.state.sessionExpired?h.a.createElement("div",{className:"alert alert-warning"},h.a.createElement(k.a,null)," ",h.a.createElement(u.a,{id:"login.session_expired",defaultMessage:"Your session has expired. Please log in again."})," ",h.a.createElement(f.a,{className:"btn-close",to:"/login",onClick:this.onDismissSessionExpired},h.a.createElement("span",null,"Ã—"))):e===I.P.GET_TERMS_ERROR?h.a.createElement("div",{className:"alert has-error no-padding"},h.a.createElement("label",{className:"control-label"},h.a.createElement(u.a,{id:"login.get_terms_error",defaultMessage:"Unable to load terms of service. If this issue persists, contact your System Administrator."}))):e===I.P.TERMS_REJECTED?h.a.createElement("div",{className:"alert alert-warning"},h.a.createElement(k.a,null),h.a.createElement(W.b,{id:"login.terms_rejected",defaultMessage:"You must agree to the terms of service before accessing {siteName}. Please contact your System Administrator for more details.",values:{siteName:this.props.siteName}})):e===I.P.SIGNIN_CHANGE?h.a.createElement("div",{className:"alert alert-success"},h.a.createElement(D.a,null),h.a.createElement(u.a,{id:"login.changed",defaultMessage:" Sign-in method changed successfully"})):e===I.P.SIGNIN_VERIFIED?h.a.createElement("div",{className:"alert alert-success"},h.a.createElement(D.a,null),h.a.createElement(u.a,{id:"login.verified",defaultMessage:" Email Verified"})):e===I.P.PASSWORD_CHANGE?h.a.createElement("div",{id:"passwordUpdatedSuccess",className:"alert alert-success"},h.a.createElement(D.a,null),h.a.createElement(u.a,{id:"login.passwordChanged",defaultMessage:" Password updated successfully"})):e===I.P.CREATE_LDAP?h.a.createElement("div",{className:"alert alert-grey"},h.a.createElement(u.a,{id:"login.ldapCreate",defaultMessage:" Enter your AD/LDAP username and password to create an account."})):null}),G(this,"createLoginOptions",()=>{const e=[],t=this.state.ldapEnabled,a=this.props.enableSignUpWithGitLab,i=this.props.enableSignUpWithGoogle,s=this.props.enableSignUpWithOffice365,n=this.state.samlEnabled,r=this.state.usernameSigninEnabled,o=this.state.emailSigninEnabled;if(o||r||t){let t="";this.state.serverError&&(t=" has-error"),e.push(h.a.createElement("form",{key:"loginBoxes",onSubmit:this.preSubmit},h.a.createElement("div",{className:"signup__email-container"},h.a.createElement(T.a,{error:this.state.serverError,margin:!0}),h.a.createElement("div",{className:"form-group"+t},h.a.createElement("input",{id:"loginId",className:"form-control",ref:this.loginIdInput,name:"loginId",value:this.state.loginId,onChange:this.handleLoginIdChange,placeholder:this.createLoginPlaceholder(),spellCheck:"false",autoCapitalize:"off",autoFocus:!0})),h.a.createElement("div",{className:"form-group"+t},h.a.createElement(j.a,{id:"loginPassword",type:"password",className:"form-control",ref:this.passwordInput,name:"password",value:this.state.password,onChange:this.handlePasswordChange,placeholder:{id:Object(O.b)("login.password"),defaultMessage:"Password"},spellCheck:"false"})),h.a.createElement("div",{className:"form-group"},h.a.createElement("button",{id:"loginButton",type:"submit",className:"btn btn-primary"},h.a.createElement(A.a,{id:"login_button_signing",loading:this.state.loading,text:x.fb("login.signInLoading","Signing in...")},h.a.createElement(u.a,{id:"login.signIn",defaultMessage:"Sign in"})))))))}return this.props.enableOpenServer&&this.checkSignUpEnabled()&&e.push(h.a.createElement("div",{className:"form-group",key:"signup"},h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.noAccount",defaultMessage:"Don't have an account? "}),h.a.createElement(f.a,{id:"signup",to:"/signup_user_complete"+this.props.location.search,className:"signup-team-login"},h.a.createElement(u.a,{id:"login.create",defaultMessage:"Create one now"}))))),(r||o)&&e.push(h.a.createElement("div",{id:"login_forgot",key:"forgotPassword",className:"form-group"},h.a.createElement(f.a,{to:"/reset_password"},h.a.createElement(u.a,{id:"login.forgot",defaultMessage:"I forgot my password."})))),(o||r||t)&&(a||i||n||s)&&(e.push(h.a.createElement("div",{key:"divider",className:"or__container"},h.a.createElement(u.a,{id:"login.or",defaultMessage:"or"}))),e.push(h.a.createElement("h5",{key:"oauthHeader"},h.a.createElement(u.a,{id:"login.signInWith",defaultMessage:"Sign in with:"})))),a&&e.push(h.a.createElement("a",{className:"btn btn-custom-login gitlab",key:"gitlab",href:b.Client4.getOAuthRoute()+"/gitlab/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.gitlab",defaultMessage:"GitLab"}))))),i&&e.push(h.a.createElement("a",{className:"btn btn-custom-login google",key:"google",href:b.Client4.getOAuthRoute()+"/google/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.google",defaultMessage:"Google Apps"}))))),s&&e.push(h.a.createElement("a",{className:"btn btn-custom-login office365",key:"office365",href:b.Client4.getOAuthRoute()+"/office365/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.office365",defaultMessage:"Office 365"}))))),n&&e.push(h.a.createElement("a",{className:"btn btn-custom-login saml",key:"saml",href:b.Client4.getUrl()+"/login/sso/saml"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon fa fa-lock fa--margin-top",title:"Saml icon"}),h.a.createElement("span",null,this.props.samlLoginButtonText)))),0===e.length&&e.push(h.a.createElement(T.a,{key:"noMethods",error:h.a.createElement(u.a,{id:"login.noMethods",defaultMessage:"No sign-in methods are enabled. Please contact your System Administrator."}),margin:!0})),h.a.createElement("div",null,this.createExtraText(),e)}),G(this,"hideMfa",()=>{this.setState({showMfa:!1})});let t="";new URLSearchParams(this.props.location.search).get("extra")===I.P.SIGNIN_VERIFIED&&new URLSearchParams(this.props.location.search).get("email")&&(t=new URLSearchParams(this.props.location.search).get("email")),this.state={ldapEnabled:this.props.isLicensed&&this.props.enableLdap,usernameSigninEnabled:this.props.enableSignInWithUsername,emailSigninEnabled:this.props.enableSignInWithEmail,samlEnabled:this.props.isLicensed&&this.props.enableSaml,loginId:t,password:"",showMfa:!1,loading:!1,sessionExpired:!1,brandImageError:!1},this.loginIdInput=h.a.createRef(),this.passwordInput=h.a.createRef()}shouldComponentUpdate(){return!0}componentDidMount(){if(this.configureTitle(),this.props.currentUser)return void S.f();const e=new URLSearchParams(this.props.location.search),t=e.get("extra"),a=e.get("email");t===I.P.SIGNIN_VERIFIED&&a&&this.passwordInput.current.focus(),N.a.getWasLoggedIn()&&(t===I.P.SIGNIN_CHANGE?N.a.setWasLoggedIn(!1):(this.setState({sessionExpired:!0}),e.set("extra",I.P.SESSION_EXPIRED),w.a.replace("".concat(this.props.location.pathname,"?").concat(e)))),this.showSessionExpiredNotificationIfNeeded()}componentDidUpdate(){this.configureTitle(),this.showSessionExpiredNotificationIfNeeded()}componentWillUnmount(){this.closeSessionExpiredNotification&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}render(){return h.a.createElement(q.a,null)}}G(B,"propTypes",{intl:_.a.isRequired,location:m.a.object.isRequired,isLicensed:m.a.bool.isRequired,currentUser:m.a.object,customBrandText:m.a.string,enableCustomBrand:m.a.bool.isRequired,enableLdap:m.a.bool.isRequired,enableOpenServer:m.a.bool.isRequired,enableSaml:m.a.bool.isRequired,enableSignInWithEmail:m.a.bool.isRequired,enableSignInWithUsername:m.a.bool.isRequired,enableSignUpWithEmail:m.a.bool.isRequired,enableSignUpWithGitLab:m.a.bool.isRequired,enableSignUpWithGoogle:m.a.bool.isRequired,enableSignUpWithOffice365:m.a.bool.isRequired,experimentalPrimaryTeam:m.a.string,ldapLoginFieldName:m.a.string,samlLoginButtonText:m.a.string,siteName:m.a.string,initializing:m.a.bool,actions:m.a.shape({login:m.a.func.isRequired,addUserToTeamFromInvite:m.a.func.isRequired}).isRequired});var F=Object(E.c)(B);t.default=Object(i.connect)((function(e){const t=Object(n.getConfig)(e),a="true"===Object(n.getLicense)(e).IsLicensed,i=t.CustomBrandText,s=t.CustomDescriptionText,c="true"===t.EnableCustomBrand,d="true"===t.EnableLdap,p="true"===t.EnableOpenServer,m="true"===t.EnableSaml,g="true"===t.EnableSignInWithEmail,h="true"===t.EnableSignInWithUsername,u="true"===t.EnableSignUpWithEmail,E="true"===t.EnableSignUpWithGitLab,f="true"===t.EnableSignUpWithGoogle,b="true"===t.EnableSignUpWithOffice365,S=t.LdapLoginFieldName,N=t.SamlLoginButtonText,w=t.SiteName,I=e.requests.users.logout.status===l.RequestStatus.SUCCESS||!e.storage.initialized;let v=t.ExperimentalPrimaryTeam;if(v){const t=Object(r.getTeamByName)(e,v);if(t){const a=Object(r.getMyTeamMember)(e,t.id);a&&a.team_id||(v=null)}else v=null}return{currentUser:Object(o.getCurrentUser)(e),isLicensed:a,customBrandText:i,customDescriptionText:s,enableCustomBrand:c,enableLdap:d,enableOpenServer:p,enableSaml:m,enableSignInWithEmail:g,enableSignInWithUsername:h,enableSignUpWithEmail:u,enableSignUpWithGitLab:E,enableSignUpWithGoogle:f,enableSignUpWithOffice365:b,experimentalPrimaryTeam:v,ldapLoginFieldName:S,samlLoginButtonText:N,siteName:w,initializing:I}}),(function(e){return{actions:Object(s.bindActionCreators)({login:d.a,addUserToTeamFromInvite:c.b},e)}}))(F)}}]);
//# sourceMappingURL=17.d30ca0a8208f71b763bd.js.map