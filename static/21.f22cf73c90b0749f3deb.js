(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1352:function(e,a,t){"use strict";t.d(a,"a",(function(){return i})),t.d(a,"b",(function(){return n}));t(55);var s=t(20);function i(e,a,t){return i=>r(i(s.login(e,a,t)))}function n(e,a,t){return i=>r(i(s.loginById(e,a,t)))}async function r(e){let a=await e;return a.error&&"api.context.mfa_required.app_error"===a.error.server_error_id&&(a={data:!0}),a}},1997:function(e,a,t){"use strict";t.r(a);var s=t(322),i=t(7),n=t(15),r=t(16),o=t(10),l=t(12),c=t(1211),d=t(1352),p=(t(55),t(146),t(63),t(177),t(75),t(34),t(611),t(33)),m=t.n(p),g=t(6),h=t.n(g),u=t(1130),E=t(327),b=t(1128),f=t(19),S=t(1144),N=t(124),I=t(99),v=t(0),w=t(1288),_=t(1142),U=t(40),x=t(14),L=t(569),R=t(27),y=t(1153),C=t(1138),M=t(1143),O=t(1184),W=t(1242),P=t(1187),T=t(1151);function j(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}class D extends h.a.Component{constructor(e){super(e),j(this,"configureTitle",()=>{this.state.sessionExpired?document.title=this.props.intl.formatMessage({id:"login.session_expired.title",defaultMessage:"* {siteName} - Session Expired"},{siteName:this.props.siteName}):document.title=this.props.siteName}),j(this,"showSessionExpiredNotificationIfNeeded",()=>{this.state.sessionExpired&&!this.closeSessionExpiredNotification?Object(L.a)({title:this.props.siteName,body:x.gb("login.session_expired.notification","Session Expired: Please sign in to continue receiving notifications."),requireInteraction:!0,silent:!1,onClick:()=>{window.focus(),this.closeSessionExpiredNotification()&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}}).then(e=>{this.closeSessionExpiredNotification=e}).catch(()=>{}):!this.state.sessionExpired&&this.closeSessionExpiredNotification&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}),j(this,"preSubmit",e=>{e.preventDefault(),this.onDismissSessionExpired();const{location:a}=this.props,t=a.search.replace(/(extra=password_change)&?/i,"");t!==a.search&&I.a.replace("".concat(a.pathname).concat(t).concat(a.hash));let s=this.state.loginId;this.loginIdInput.current&&(s=this.loginIdInput.current.value,s!==this.state.loginId&&this.setState({loginId:s}));let i=this.state.password;if(this.passwordInput.current&&(i=this.passwordInput.current.value,i!==this.state.password&&this.setState({password:i})),s=s.trim().toLowerCase(),!s){Object(R.b)("login.noEmail"),Object(R.b)("login.noEmailLdapUsername"),Object(R.b)("login.noEmailUsername"),Object(R.b)("login.noEmailUsernameLdapUsername"),Object(R.b)("login.noLdapUsername"),Object(R.b)("login.noUsername"),Object(R.b)("login.noUsernameLdapUsername");let e="login.no";return this.state.emailSigninEnabled&&(e+="Email"),this.state.usernameSigninEnabled&&(e+="Username"),this.state.ldapEnabled&&(e+="LdapUsername"),void this.setState({serverError:h.a.createElement(u.a,{id:e,values:{ldapUsername:this.props.ldapLoginFieldName||x.gb("login.ldapUsernameLower","AD/LDAP username")}})})}i?this.submit(s,i,""):this.setState({serverError:h.a.createElement(u.a,{id:"login.noPassword",defaultMessage:"Please enter your password"})})}),j(this,"submit",(e,a,t)=>{this.setState({serverError:null,loading:!0}),this.props.actions.login(e,a,t).then(async({error:a})=>{if(a)return void("api.user.login.not_verified.app_error"===a.server_error_id?I.a.push("/should_verify_email?&email="+encodeURIComponent(e)):"store.sql_user.get_for_login.app_error"===a.server_error_id||"ent.ldap.do_login.user_not_registered.app_error"===a.server_error_id?this.setState({showMfa:!1,loading:!1,serverError:h.a.createElement(u.a,{id:"login.userNotFound",defaultMessage:"We couldn't find an account matching your login credentials."})}):"api.user.check_user_password.invalid.app_error"===a.server_error_id||"ent.ldap.do_login.invalid_password.app_error"===a.server_error_id?this.setState({showMfa:!1,loading:!1,serverError:h.a.createElement(u.a,{id:"login.invalidPassword",defaultMessage:"Your password is incorrect."})}):this.state.showMfa||"mfa.validate_token.authenticate.app_error"!==a.server_error_id?this.setState({showMfa:!1,serverError:a.message,loading:!1}):this.setState({showMfa:!0}));const t=new URLSearchParams(this.props.location.search),s=t.get("t")||"",i=t.get("id")||"";if(i||s){const{data:e}=await this.props.actions.addUserToTeamFromInvite(s,i);e?this.finishSignin(e):this.finishSignin()}else this.finishSignin()})}),j(this,"finishSignin",e=>{const a=this.props.experimentalPrimaryTeam,t=new URLSearchParams(this.props.location.search).get("redirect_to");x.nb(),N.a.setWasLoggedIn(!0),t&&t.match(/^\/([^/]|$)/)?I.a.push(t):e?I.a.push("/".concat(e.name)):a?I.a.push("/".concat(a)):S.f()}),j(this,"handleLoginIdChange",e=>{this.setState({loginId:e.target.value})}),j(this,"handlePasswordChange",e=>{this.setState({password:e.target.value})}),j(this,"handleBrandImageError",()=>{this.setState({brandImageError:!0})}),j(this,"createCustomLogin",()=>{if(this.props.enableCustomBrand){const e=this.props.customBrandText||"",a=U.e(e),t=f.Client4.getBrandImageUrl(0),s=this.state.brandImageError?{display:"none"}:{};return h.a.createElement("div",null,h.a.createElement("img",{alt:"brand image",src:t,onError:this.handleBrandImageError,style:s}),h.a.createElement("div",null,Object(w.a)(a,!1,{mentions:!1,imagesMetadata:null})))}return null}),j(this,"createLoginPlaceholder",()=>{const e=this.state.ldapEnabled,a=this.state.usernameSigninEnabled,t=[];return this.state.emailSigninEnabled&&t.push(x.gb("login.email","Email")),a&&t.push(x.gb("login.username","Username")),e&&(this.props.ldapLoginFieldName?t.push(this.props.ldapLoginFieldName):t.push(x.gb("login.ldapUsername","AD/LDAP Username"))),t.length>=2?t.slice(0,t.length-1).join(", ")+x.gb("login.placeholderOr"," or ")+t[t.length-1]:1===t.length?t[0]:""}),j(this,"checkSignUpEnabled",()=>this.props.enableSignUpWithEmail||this.props.enableSignUpWithGitLab||this.props.enableSignUpWithOffice365||this.props.enableSignUpWithGoogle||this.props.enableLdap||this.props.enableSaml),j(this,"onDismissSessionExpired",()=>{N.a.setWasLoggedIn(!1),this.setState({sessionExpired:!1})}),j(this,"createExtraText",()=>{const e=new URLSearchParams(this.props.location.search).get("extra");return this.state.sessionExpired?h.a.createElement("div",{className:"alert alert-warning"},h.a.createElement(P.a,null)," ",h.a.createElement(u.a,{id:"login.session_expired",defaultMessage:"Your session has expired. Please log in again."})," ",h.a.createElement(b.a,{className:"btn-close",to:"/login",onClick:this.onDismissSessionExpired},h.a.createElement("span",null,"Ã—"))):e===v.Q.GET_TERMS_ERROR?h.a.createElement("div",{className:"alert has-error no-padding"},h.a.createElement("label",{className:"control-label"},h.a.createElement(u.a,{id:"login.get_terms_error",defaultMessage:"Unable to load terms of service. If this issue persists, contact your System Administrator."}))):e===v.Q.TERMS_REJECTED?h.a.createElement("div",{className:"alert alert-warning"},h.a.createElement(P.a,null),h.a.createElement(C.b,{id:"login.terms_rejected",defaultMessage:"You must agree to the terms of service before accessing {siteName}. Please contact your System Administrator for more details.",values:{siteName:this.props.siteName}})):e===v.Q.SIGNIN_CHANGE?h.a.createElement("div",{className:"alert alert-success"},h.a.createElement(W.a,null),h.a.createElement(u.a,{id:"login.changed",defaultMessage:" Sign-in method changed successfully"})):e===v.Q.SIGNIN_VERIFIED?h.a.createElement("div",{className:"alert alert-success"},h.a.createElement(W.a,null),h.a.createElement(u.a,{id:"login.verified",defaultMessage:" Email Verified"})):e===v.Q.PASSWORD_CHANGE?h.a.createElement("div",{id:"passwordUpdatedSuccess",className:"alert alert-success"},h.a.createElement(W.a,null),h.a.createElement(u.a,{id:"login.passwordChanged",defaultMessage:" Password updated successfully"})):e===v.Q.CREATE_LDAP?h.a.createElement("div",{className:"alert alert-grey"},h.a.createElement(u.a,{id:"login.ldapCreate",defaultMessage:" Enter your AD/LDAP username and password to create an account."})):null}),j(this,"createLoginOptions",()=>{const e=[],a=this.state.ldapEnabled,t=this.props.enableSignUpWithGitLab,s=this.props.enableSignUpWithGoogle,i=this.props.enableSignUpWithOffice365,n=this.state.samlEnabled,r=this.state.usernameSigninEnabled,o=this.state.emailSigninEnabled;if(o||r||a){let a="";this.state.serverError&&(a=" has-error"),e.push(h.a.createElement("form",{key:"loginBoxes",onSubmit:this.preSubmit},h.a.createElement("div",{className:"signup__email-container"},h.a.createElement(y.a,{error:this.state.serverError,margin:!0}),h.a.createElement("div",{className:"form-group"+a},h.a.createElement("input",{id:"loginId",className:"form-control",ref:this.loginIdInput,name:"loginId",value:this.state.loginId,onChange:this.handleLoginIdChange,placeholder:this.createLoginPlaceholder(),spellCheck:"false",autoCapitalize:"off",autoFocus:!0})),h.a.createElement("div",{className:"form-group"+a},h.a.createElement(T.a,{id:"loginPassword",type:"password",className:"form-control",ref:this.passwordInput,name:"password",value:this.state.password,onChange:this.handlePasswordChange,placeholder:{id:Object(R.b)("login.password"),defaultMessage:"Password"},spellCheck:"false"})),h.a.createElement("div",{className:"form-group"},h.a.createElement("button",{id:"loginButton",type:"submit",className:"btn btn-primary"},h.a.createElement(O.a,{id:"login_button_signing",loading:this.state.loading,text:x.gb("login.signInLoading","Signing in...")},h.a.createElement(u.a,{id:"login.signIn",defaultMessage:"Sign in"})))))))}return this.props.enableOpenServer&&this.checkSignUpEnabled()&&e.push(h.a.createElement("div",{className:"form-group",key:"signup"},h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.noAccount",defaultMessage:"Don't have an account? "}),h.a.createElement(b.a,{id:"signup",to:"/signup_user_complete"+this.props.location.search,className:"signup-team-login"},h.a.createElement(u.a,{id:"login.create",defaultMessage:"Create one now"}))))),(r||o)&&e.push(h.a.createElement("div",{id:"login_forgot",key:"forgotPassword",className:"form-group"},h.a.createElement(b.a,{to:"/reset_password"},h.a.createElement(u.a,{id:"login.forgot",defaultMessage:"I forgot my password."})))),(o||r||a)&&(t||s||n||i)&&(e.push(h.a.createElement("div",{key:"divider",className:"or__container"},h.a.createElement(u.a,{id:"login.or",defaultMessage:"or"}))),e.push(h.a.createElement("h5",{key:"oauthHeader"},h.a.createElement(u.a,{id:"login.signInWith",defaultMessage:"Sign in with:"})))),t&&e.push(h.a.createElement("a",{className:"btn btn-custom-login gitlab",key:"gitlab",href:f.Client4.getOAuthRoute()+"/gitlab/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.gitlab",defaultMessage:"GitLab"}))))),s&&e.push(h.a.createElement("a",{className:"btn btn-custom-login google",key:"google",href:f.Client4.getOAuthRoute()+"/google/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.google",defaultMessage:"Google Apps"}))))),i&&e.push(h.a.createElement("a",{className:"btn btn-custom-login office365",key:"office365",href:f.Client4.getOAuthRoute()+"/office365/login"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon"}),h.a.createElement("span",null,h.a.createElement(u.a,{id:"login.office365",defaultMessage:"Office 365"}))))),n&&e.push(h.a.createElement("a",{className:"btn btn-custom-login saml",key:"saml",href:f.Client4.getUrl()+"/login/sso/saml"+this.props.location.search},h.a.createElement("span",null,h.a.createElement("span",{className:"icon fa fa-lock fa--margin-top",title:"Saml icon"}),h.a.createElement("span",null,this.props.samlLoginButtonText)))),0===e.length&&e.push(h.a.createElement(y.a,{key:"noMethods",error:h.a.createElement(u.a,{id:"login.noMethods",defaultMessage:"No sign-in methods are enabled. Please contact your System Administrator."}),margin:!0})),h.a.createElement("div",null,this.createExtraText(),e)}),j(this,"hideMfa",()=>{this.setState({showMfa:!1})});let a="";new URLSearchParams(this.props.location.search).get("extra")===v.Q.SIGNIN_VERIFIED&&new URLSearchParams(this.props.location.search).get("email")&&(a=new URLSearchParams(this.props.location.search).get("email")),this.state={ldapEnabled:this.props.isLicensed&&this.props.enableLdap,usernameSigninEnabled:this.props.enableSignInWithUsername,emailSigninEnabled:this.props.enableSignInWithEmail,samlEnabled:this.props.isLicensed&&this.props.enableSaml,loginId:a,password:"",showMfa:!1,loading:!1,sessionExpired:!1,brandImageError:!1},this.loginIdInput=h.a.createRef(),this.passwordInput=h.a.createRef()}shouldComponentUpdate(){return!0}componentDidMount(){if(this.configureTitle(),this.props.currentUser)return void S.f();const e=new URLSearchParams(this.props.location.search),a=e.get("extra"),t=e.get("email");a===v.Q.SIGNIN_VERIFIED&&t&&this.passwordInput.current.focus(),N.a.getWasLoggedIn()&&(a===v.Q.SIGNIN_CHANGE?N.a.setWasLoggedIn(!1):(this.setState({sessionExpired:!0}),e.set("extra",v.Q.SESSION_EXPIRED),I.a.replace("".concat(this.props.location.pathname,"?").concat(e)))),this.showSessionExpiredNotificationIfNeeded()}componentDidUpdate(){this.configureTitle(),this.showSessionExpiredNotificationIfNeeded()}componentWillUnmount(){this.closeSessionExpiredNotification&&(this.closeSessionExpiredNotification(),this.closeSessionExpiredNotification=null)}render(){return h.a.createElement(M.a,null)}}j(D,"propTypes",{intl:_.a.isRequired,location:m.a.object.isRequired,isLicensed:m.a.bool.isRequired,currentUser:m.a.object,customBrandText:m.a.string,enableCustomBrand:m.a.bool.isRequired,enableLdap:m.a.bool.isRequired,enableOpenServer:m.a.bool.isRequired,enableSaml:m.a.bool.isRequired,enableSignInWithEmail:m.a.bool.isRequired,enableSignInWithUsername:m.a.bool.isRequired,enableSignUpWithEmail:m.a.bool.isRequired,enableSignUpWithGitLab:m.a.bool.isRequired,enableSignUpWithGoogle:m.a.bool.isRequired,enableSignUpWithOffice365:m.a.bool.isRequired,experimentalPrimaryTeam:m.a.string,ldapLoginFieldName:m.a.string,samlLoginButtonText:m.a.string,siteName:m.a.string,initializing:m.a.bool,actions:m.a.shape({login:m.a.func.isRequired,addUserToTeamFromInvite:m.a.func.isRequired}).isRequired});var k=Object(E.c)(D);a.default=Object(s.connect)((function(e){const a=Object(n.getConfig)(e),t="true"===Object(n.getLicense)(e).IsLicensed,s=a.CustomBrandText,i=a.CustomDescriptionText,c="true"===a.EnableCustomBrand,d="true"===a.EnableLdap,p="true"===a.EnableOpenServer,m="true"===a.EnableSaml,g="true"===a.EnableSignInWithEmail,h="true"===a.EnableSignInWithUsername,u="true"===a.EnableSignUpWithEmail,E="true"===a.EnableSignUpWithGitLab,b="true"===a.EnableSignUpWithGoogle,f="true"===a.EnableSignUpWithOffice365,S=a.LdapLoginFieldName,N=a.SamlLoginButtonText,I=a.SiteName,v=e.requests.users.logout.status===l.RequestStatus.SUCCESS||!e.storage.initialized;let w=a.ExperimentalPrimaryTeam;if(w){const a=Object(r.getTeamByName)(e,w);if(a){const t=Object(r.getMyTeamMember)(e,a.id);t&&t.team_id||(w=null)}else w=null}return{currentUser:Object(o.getCurrentUser)(e),isLicensed:t,customBrandText:s,customDescriptionText:i,enableCustomBrand:c,enableLdap:d,enableOpenServer:p,enableSaml:m,enableSignInWithEmail:g,enableSignInWithUsername:h,enableSignUpWithEmail:u,enableSignUpWithGitLab:E,enableSignUpWithGoogle:b,enableSignUpWithOffice365:f,experimentalPrimaryTeam:w,ldapLoginFieldName:S,samlLoginButtonText:N,siteName:I,initializing:v}}),(function(e){return{actions:Object(i.bindActionCreators)({login:d.a,addUserToTeamFromInvite:c.b},e)}}))(k)}}]);
//# sourceMappingURL=21.f22cf73c90b0749f3deb.js.map