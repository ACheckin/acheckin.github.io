(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1158:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));a(146);var r=a(33),n=a.n(r),s=a(6),o=a.n(s),c=a(1130),i=a(1128);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class u extends o.a.PureComponent{render(){return o.a.createElement("div",{id:"back_button",className:"signup-header"},o.a.createElement(i.a,{onClick:this.props.onClick,to:this.props.url},o.a.createElement(c.a,{id:"generic_icons.back",defaultMessage:"Back Icon"},e=>o.a.createElement("span",{id:"back_button_icon",className:"fa fa-1x fa-angle-left",title:e.toString()})),o.a.createElement(c.a,{id:"web.header.back",defaultMessage:"Back"})))}}l(u,"propTypes",{url:n.a.string,onClick:n.a.func}),l(u,"defaultProps",{url:"/"})},1168:function(e,t,a){e.exports=a.p+"files/67504a826caf7430e472b4240bb534d7.png"},1255:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a(6),n=a.n(r),s=a(1130);class o extends n.a.PureComponent{render(){return n.a.createElement(s.a,{id:"generic_icons.logout",defaultMessage:"Logout Icon"},e=>n.a.createElement("i",{className:"fa fa-1x fa-angle-left",title:e}))}}},1977:function(e,t,a){"use strict";a.r(t);var r=a(322),n=a(15),s=(a(176),a(145),a(34),a(33)),o=a.n(s),c=a(6),i=a.n(c),l=a(1130),u=a(1129),m=a(1143),d=a(1168),p=a.n(d),f=a(1158),h=a(1255),b=a(7),g=a(10),E=a(20);function y(e){return(t,a)=>{const r=Object(g.getCurrentUserId)(a());return t(E.updateUserMfa(r,!0,e))}}function v(){return(e,t)=>{const a=Object(g.getCurrentUserId)(t());return e(E.generateMfaSecret(a))}}a(63);var M=a(14),N=a(27),C=a(1138),k=a(1151);function O(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class A extends i.a.Component{constructor(e){super(e),O(this,"submit",e=>{e.preventDefault();const t=this.input.current.value.replace(/\s/g,"");t&&0!==t.length?(this.setState({error:null}),this.props.actions.activateMfa(t).then(({error:e})=>{e?"ent.mfa.activate.authenticate.app_error"===e.server_error_id?this.setState({error:M.fb("mfa.setup.badCode","Invalid code. If this issue persists, contact your System Administrator.")}):this.setState({error:e.message}):this.props.history.push("/mfa/confirm")})):this.setState({error:M.fb("mfa.setup.codeError","Please enter the code from Google Authenticator.")})}),this.state={secret:"",qrCode:""},this.input=i.a.createRef()}componentDidMount(){const e=this.props.currentUser;e&&!e.mfa_active?this.props.actions.generateMfaSecret().then(({data:e,error:t})=>{t?this.setState({serverError:t.message}):this.setState({secret:e.secret,qrCode:e.qr_code})}):this.props.history.push("/")}render(){let e,t,a="form-group";return this.state.error&&(e=i.a.createElement("div",{className:"form-group has-error"},i.a.createElement("label",{className:"control-label"},this.state.error)),a+=" has-error"),this.props.enforceMultifactorAuthentication&&(t=i.a.createElement("p",null,i.a.createElement(C.b,{id:"mfa.setup.required",defaultMessage:"**Multi-factor authentication is required on {siteName}.**",values:{siteName:this.props.siteName}}))),i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.submit,className:a},t,i.a.createElement("p",null,i.a.createElement(C.b,{id:"mfa.setup.step1",defaultMessage:"**Step 1: **On your phone, download Google Authenticator from [iTunes](!https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8') or [Google Play](!https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en)"})),i.a.createElement("p",null,i.a.createElement(C.b,{id:"mfa.setup.step2",defaultMessage:"**Step 2: **Use Google Authenticator to scan this QR code, or manually type in the secret key"})),i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"col-sm-12"},i.a.createElement("img",{alt:"qr code image",style:S.qrCode,src:"data:image/png;base64,"+this.state.qrCode}))),i.a.createElement("br",null),i.a.createElement("div",{className:"form-group"},i.a.createElement("p",{className:"col-sm-12"},i.a.createElement(l.a,{id:"mfa.setup.secret",defaultMessage:"Secret: {secret}",values:{secret:this.state.secret}}))),i.a.createElement("p",null,i.a.createElement(C.b,{id:"mfa.setup.step3",defaultMessage:"**Step 3: **Enter the code generated by Google Authenticator"})),i.a.createElement("p",null,i.a.createElement(k.a,{ref:this.input,className:"form-control",placeholder:{id:Object(N.b)("mfa.setup.code"),defaultMessage:"MFA Code"},autoFocus:!0})),e,i.a.createElement("button",{type:"submit",className:"btn btn-primary"},i.a.createElement(l.a,{id:"mfa.setup.save",defaultMessage:"Save"}))))}}O(A,"propTypes",{currentUser:o.a.object,siteName:o.a.string,enforceMultifactorAuthentication:o.a.bool.isRequired,actions:o.a.shape({activateMfa:o.a.func.isRequired,generateMfaSecret:o.a.func.isRequired}).isRequired});const S={qrCode:{maxHeight:170}};var j=Object(r.connect)((function(e){const t=Object(n.getConfig)(e),a=t.SiteName,r="true"===t.EnforceMultifactorAuthentication;return{currentUser:Object(g.getCurrentUser)(e),siteName:a,enforceMultifactorAuthentication:r}}),(function(e){return{actions:Object(b.bindActionCreators)({activateMfa:y,generateMfaSecret:v},e)}}))(A);function q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const w=a(0).P.KeyCodes;class P extends i.a.Component{constructor(...e){super(...e),q(this,"submit",e=>{e.preventDefault(),Object(m.f)()}),q(this,"onKeyPress",e=>{Object(M.V)(e,w.ENTER)&&this.submit(e)})}componentDidMount(){document.body.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.body.removeEventListener("keydown",this.onKeyPress)}render(){return i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.submit,onKeyPress:this.onKeyPress,className:"form-group"},i.a.createElement("p",null,i.a.createElement(C.b,{id:"mfa.confirm.complete",defaultMessage:"**Set up complete!**"})),i.a.createElement("p",null,i.a.createElement(l.a,{id:"mfa.confirm.secure",defaultMessage:"Your account is now secure. Next time you sign in, you will be asked to enter a code from the Google Authenticator app on your phone."})),i.a.createElement("button",{type:"submit",className:"btn btn-primary"},i.a.createElement(l.a,{id:"mfa.confirm.okay",defaultMessage:"Okay"}))))}}class R extends i.a.Component{constructor(...e){var t,a,r;super(...e),r=e=>{e.preventDefault(),Object(m.e)("/login")},(a="handleOnClick")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}componentDidMount(){document.body.classList.add("sticky"),document.getElementById("root").classList.add("container-fluid"),this.props.enableMultifactorAuthentication||this.props.history.push("/")}componentWillUnmount(){document.body.classList.remove("sticky"),document.getElementById("root").classList.remove("container-fluid")}render(){let e;return e=this.props.mfa&&this.props.enforceMultifactorAuthentication?i.a.createElement("div",{className:"signup-header"},i.a.createElement("button",{className:"style--none color--link",onClick:this.handleOnClick},i.a.createElement(h.a,null),i.a.createElement(l.a,{id:"web.header.logout",defaultMessage:"Logout"}))):i.a.createElement(f.a,null),i.a.createElement("div",{className:"inner-wrap"},i.a.createElement("div",{className:"row content"},i.a.createElement("div",null,e,i.a.createElement("div",{className:"col-sm-12"},i.a.createElement("div",{className:"signup-team__container"},i.a.createElement("h3",null,i.a.createElement(l.a,{id:"mfa.setupTitle",defaultMessage:"Multi-factor Authentication Setup"})),i.a.createElement("img",{alt:"signup team logo",className:"signup-team-logo",src:p.a}),i.a.createElement("div",{id:"mfa"},i.a.createElement(u.d,null,i.a.createElement(u.b,{path:"".concat(this.props.match.url,"/setup"),render:e=>i.a.createElement(j,Object.assign({state:this.state,updateParent:this.updateParent},e))}),i.a.createElement(u.b,{path:"".concat(this.props.match.url,"/confirm"),render:e=>i.a.createElement(P,Object.assign({state:this.state,updateParent:this.updateParent},e))}))))))))}}R.propTypes={location:o.a.object.isRequired,children:o.a.node,mfa:o.a.bool.isRequired,enableMultifactorAuthentication:o.a.bool.isRequired,enforceMultifactorAuthentication:o.a.bool.isRequired,match:o.a.shape({url:o.a.string.isRequired}).isRequired};t.default=Object(r.connect)((function(e){const t=Object(n.getLicense)(e),a=Object(n.getConfig)(e);return{mfa:"true"===t.MFA,enableMultifactorAuthentication:"true"===a.EnableMultifactorAuthentication,enforceMultifactorAuthentication:"true"===a.EnforceMultifactorAuthentication}}))(R)}}]);
//# sourceMappingURL=14.4a4d5ca847b98147e3e4.js.map